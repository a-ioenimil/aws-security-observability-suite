groups:
  - name: fastapi_alerts
    rules:
      - alert: FastApiHighErrorRate
        expr: |
          (
            sum(rate(http_server_duration_milliseconds_count{job="backend", http_status_code=~"5.."}[5m])) or vector(0)
          )
          /
          (
            sum(rate(http_server_duration_milliseconds_count{job="backend"}[5m])) > 0
          )
          > 0.05
        for: 1m
        labels:
          severity: critical
          service: fastapi
        annotations:
          summary: "FastAPI High Error Rate"
          description: "Error rate is {{ humanizePercentage $value }} â€” exceeded 5% threshold over the last 5 minutes."
